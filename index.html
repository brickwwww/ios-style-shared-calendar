<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS é£æ ¼æ—¥å†</title>
    <style>
        :root {
            --ios-bg: #F2F2F7;
            --ios-card: #FFFFFF;
            --ios-red: #FF3B30;
            --ios-blue: #007AFF;
            --ios-gray: #8E8E93;
            --ios-separator: #C6C6C8;
            --ios-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            
            /* äº‹é¡¹ç±»å‹é¢œè‰² */
            --work-color: #FF3B30;     /* å·¥ä½œ - çº¢è‰² */
            --life-color: #007AFF;     /* ç”Ÿæ´» - è“è‰² */
            --study-color: #34C759;    /* å­¦ä¹  - ç»¿è‰² */
            --health-color: #FF9500;   /* å¥åº· - æ©™è‰² */
            --social-color: #AF52DE;   /* ç¤¾äº¤ - ç´«è‰² */
            --other-color: #8E8E93;    /* å…¶ä»– - ç°è‰² */
        }

        body {
            font-family: var(--ios-font);
            background-color: var(--ios-bg);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            color: #000;
        }

        /* App Container */
        .app-container {
            width: 100%;
            max-width: 450px; /* Mobile size simulation */
            background-color: var(--ios-card);
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Header (Month/Year) */
        header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 0.5px solid var(--ios-separator);
            z-index: 10;
        }

        header h1 {
            font-size: 17px;
            font-weight: 600;
            margin: 0;
            color: var(--ios-red); /* Apple Calendar uses Red for current view or accents */
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--ios-red);
            font-size: 17px;
            cursor: pointer;
        }

        /* Calendar Grid */
        .calendar-body {
            padding: 10px;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: var(--ios-gray);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day {
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            border-radius: 50%;
            position: relative;
            transition: background 0.2s;
        }

        .day:hover {
            background-color: #f0f0f0;
        }

        /* Today's Date Style */
        .day.today {
            background-color: var(--ios-red);
            color: white;
            font-weight: 600;
        }

        /* Selected Date Style */
        .day.selected {
            background-color: #000;
            color: white;
        }
        
        .day.has-event {
            position: relative;
        }
        
        .day .event-dots {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2px;
        }
        
        .day .event-dot {
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background-color: var(--ios-gray);
        }
        
        .day.today .event-dot {
            background-color: white;
        }
        
        .event-dot.work { background-color: var(--work-color); }
        .event-dot.life { background-color: var(--life-color); }
        .event-dot.study { background-color: var(--study-color); }
        .event-dot.health { background-color: var(--health-color); }
        .event-dot.social { background-color: var(--social-color); }
        .event-dot.other { background-color: var(--other-color); }
        
        .day.today .event-dot.work,
        .day.today .event-dot.life,
        .day.today .event-dot.study,
        .day.today .event-dot.health,
        .day.today .event-dot.social,
        .day.today .event-dot.other {
            background-color: white;
        }

        .day.empty {
            pointer-events: none;
        }

        /* Task/Event List Section */
        .event-section {
            flex: 1;
            background-color: var(--ios-bg);
            padding: 20px;
            overflow-y: auto;
            border-top: 0.5px solid var(--ios-separator);
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-btn {
            font-size: 24px;
            color: var(--ios-red);
            background: none;
            border: none;
            cursor: pointer;
        }

        /* Task Item Card */
        .task-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .task-time {
            width: 60px;
            font-size: 14px;
            color: var(--ios-gray);
            font-weight: 500;
        }

        .task-divider {
            width: 2px;
            height: 20px;
            background-color: var(--ios-red);
            margin: 0 15px;
            border-radius: 2px;
        }
        
        /* äº‹é¡¹ç±»å‹é¢œè‰²æ ·å¼ */
        .task-divider.work { background-color: var(--work-color); }
        .task-divider.life { background-color: var(--life-color); }
        .task-divider.study { background-color: var(--study-color); }
        .task-divider.health { background-color: var(--health-color); }
        .task-divider.social { background-color: var(--social-color); }
        .task-divider.other { background-color: var(--other-color); }
        
        .task-card .task-category {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: auto;
            font-weight: 500;
            color: white;
        }
        
        .task-category.work { background-color: var(--work-color); }
        .task-category.life { background-color: var(--life-color); }
        .task-category.study { background-color: var(--study-color); }
        .task-category.health { background-color: var(--health-color); }
        .task-category.social { background-color: var(--social-color); }
        .task-category.other { background-color: var(--other-color); }

        .task-info h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
        }
        
        /* Modal for Adding Tasks */
        #modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: flex-end; /* Slide up from bottom */
        }
        
        .modal-content {
            background: var(--ios-bg);
            width: 100%;
            max-width: 450px;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--ios-separator);
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            font-family: var(--ios-font);
        }
        
        select {
            background-color: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .modal-btn {
            font-size: 17px;
            border: none;
            background: none;
            cursor: pointer;
        }
        
        .cancel { color: var(--ios-gray); }
        .save { color: var(--ios-blue); font-weight: 600; }
        
        /* ç™»å½•ç•Œé¢æ ·å¼ */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--ios-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-container {
            background: var(--ios-card);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 350px;
        }
        
        .login-title {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--ios-red);
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--ios-gray);
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.2s;
        }
        
        .login-btn.primary {
            background: var(--ios-blue);
            color: white;
        }
        
        .login-btn.primary:hover {
            background: #0056CC;
        }
        
        .login-btn.secondary {
            background: var(--ios-bg);
            color: var(--ios-blue);
            border: 1px solid var(--ios-separator);
        }
        
        .login-btn.secondary:hover {
            background: #E5E5EA;
        }
        
        /* ç”¨æˆ·ä¿¡æ¯æ  */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: var(--ios-gray);
        }
        
        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--ios-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        
        .logout-btn {
            background: none;
            border: none;
            color: var(--ios-red);
            cursor: pointer;
            font-size: 14px;
            margin-left: auto;
        }
        
        /* å…±äº«ç”¨æˆ·åˆ—è¡¨ */
        .shared-users {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--ios-separator);
        }
        
        .shared-user {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--ios-gray);
        }
        
        .shared-user .user-avatar {
            width: 20px;
            height: 20px;
            font-size: 10px;
        }
        
        .online-indicator {
            width: 6px;
            height: 6px;
            background: #34C759;
            border-radius: 50%;
            margin-left: auto;
        }

    </style>
</head>
<body>

<!-- ç™»å½•ç•Œé¢ -->
<div id="loginScreen" class="login-screen">
    <div class="login-container">
        <h2 class="login-title">ğŸ“…</h2>
        <p class="login-subtitle">å…±äº«æ—¥å†</p>
        <input type="text" id="usernameInput" placeholder="è¾“å…¥æ‚¨çš„ç”¨æˆ·å" style="margin-bottom: 20px;">
        <button class="login-btn primary" onclick="login()">ç™»å½•</button>
        <button class="login-btn secondary" onclick="showGuestLogin()">è®¿å®¢æ¨¡å¼</button>
        <div id="guestOptions" style="display: none; margin-top: 20px;">
            <input type="text" id="guestNameInput" placeholder="è®¿å®¢æ˜µç§°ï¼ˆå¯é€‰ï¼‰">
            <button class="login-btn primary" onclick="loginAsGuest()" style="margin-top: 10px;">ä»¥è®¿å®¢èº«ä»½ç»§ç»­</button>
        </div>
    </div>
</div>

<div class="app-container" id="mainApp" style="display: none;">
    <header>
        <button class="nav-btn" onclick="changeMonth(-1)">â€¹</button>
        <h1 id="currentMonthYear">2025å¹´11æœˆ</h1>
        <button class="nav-btn" onclick="changeMonth(1)">â€º</button>
    </header>
    
    <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
    <div class="user-info" style="padding: 10px 20px; border-bottom: 0.5px solid var(--ios-separator);">
        <div class="user-avatar" id="userAvatar">U</div>
        <span id="currentUser">ç”¨æˆ·</span>
        <button class="logout-btn" onclick="logout()">é€€å‡º</button>
        <div class="shared-users" id="sharedUsers">
            <!-- åŠ¨æ€åŠ è½½å…¶ä»–ç”¨æˆ· -->
        </div>
    </div>

    <div class="calendar-body">
        <div class="weekdays">
            <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
        </div>
        <div class="days" id="daysGrid">
            </div>
    </div>

    <div class="event-section">
        <div class="section-title">
            <span id="selectedDateLabel">ä»Šå¤©</span>
            <button class="add-btn" onclick="openModal()">+</button>
        </div>
        <div id="taskList">
            </div>
    </div>
</div>

<div id="modal">
    <div class="modal-content">
        <h3>æ–°å»ºäº‹ä»¶</h3>
        <input type="text" id="eventTitle" placeholder="äº‹ä»¶æ ‡é¢˜">
        <input type="time" id="eventTime">
        <select id="eventCategory">
            <option value="work">ğŸ¢ å·¥ä½œ</option>
            <option value="life">ğŸ  ç”Ÿæ´»</option>
            <option value="study">ğŸ“š å­¦ä¹ </option>
            <option value="health">ğŸ’ª å¥åº·</option>
            <option value="social">ğŸ‘¥ ç¤¾äº¤</option>
            <option value="other">ğŸ“ å…¶ä»–</option>
        </select>
        <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
            <input type="checkbox" id="isPrivate" style="width: auto;">
            <label for="isPrivate" style="font-size: 14px; color: var(--ios-gray);">ä»…æˆ‘å¯è§</label>
        </div>
        <div class="modal-actions">
            <button class="modal-btn cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="modal-btn save" onclick="saveEvent()">æ·»åŠ </button>
        </div>
    </div>
</div>

<script>
    const monthYearEl = document.getElementById('currentMonthYear');
    const daysGrid = document.getElementById('daysGrid');
    const selectedDateLabel = document.getElementById('selectedDateLabel');
    const taskList = document.getElementById('taskList');
    const modal = document.getElementById('modal');

    let currentDate = new Date();
    let selectedDate = new Date();
    
    // å¤šç”¨æˆ·å…±äº«æ•°æ®å­˜å‚¨
    let events = {};
    let currentUser = null;
    let users = {}; // ç”¨æˆ·æ•°æ®å­˜å‚¨
    let sharedUsers = []; // å½“å‰åœ¨çº¿ç”¨æˆ·
    
    // äº‹é¡¹ç±»å‹é…ç½®
    const categoryConfig = {
        work: { name: 'å·¥ä½œ', color: 'var(--work-color)', emoji: 'ğŸ¢' },
        life: { name: 'ç”Ÿæ´»', color: 'var(--life-color)', emoji: 'ğŸ ' },
        study: { name: 'å­¦ä¹ ', color: 'var(--study-color)', emoji: 'ğŸ“š' },
        health: { name: 'å¥åº·', color: 'var(--health-color)', emoji: 'ğŸ’ª' },
        social: { name: 'ç¤¾äº¤', color: 'var(--social-color)', emoji: 'ğŸ‘¥' },
        other: { name: 'å…¶ä»–', color: 'var(--other-color)', emoji: 'ğŸ“' }
    };
    
    // å­˜å‚¨æ‰€æœ‰æ³¨å†Œç”¨æˆ·ï¼ˆä»æœ¬åœ°å­˜å‚¨åŠ è½½ï¼‰
    let allUsers = []; 

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        // Update Header
        const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ",
            "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
        monthYearEl.innerText = `${year}å¹´${monthNames[month]}`;

        // Logic for grid generation
        const firstDayIndex = new Date(year, month, 1).getDay();
        const lastDay = new Date(year, month + 1, 0).getDate();

        daysGrid.innerHTML = "";

        // Empty slots for days before the 1st
        for (let i = 0; i < firstDayIndex; i++) {
            const emptyDiv = document.createElement('div');
            emptyDiv.classList.add('day', 'empty');
            daysGrid.appendChild(emptyDiv);
        }

        // Days of the month
        for (let i = 1; i <= lastDay; i++) {
            const dayDiv = document.createElement('div');
            dayDiv.innerText = i;
            dayDiv.classList.add('day');

            const dateKey = formatDateKey(new Date(year, month, i));

            // Check if it's today
            const today = new Date();
            if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                dayDiv.classList.add('today');
            }

            // Check if selected
            if (i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                dayDiv.classList.add('selected');
                // Start loop with this date selected
            }
            
            // Check for events (dot indicator)
            if (events[dateKey] && events[dateKey].length > 0) {
                dayDiv.classList.add('has-event');
                
                // æ·»åŠ å½©è‰²åœ†ç‚¹
                const dotsContainer = document.createElement('div');
                dotsContainer.className = 'event-dots';
                
                // è·å–è¯¥æ—¥æœŸçš„æ‰€æœ‰äº‹é¡¹ç±»å‹ï¼ˆå»é‡ï¼‰
                const categories = [...new Set(events[dateKey].map(event => event.category || 'other'))];
                
                // æœ€å¤šæ˜¾ç¤º3ä¸ªåœ†ç‚¹
                categories.slice(0, 3).forEach(category => {
                    const dot = document.createElement('div');
                    dot.className = `event-dot ${category}`;
                    dotsContainer.appendChild(dot);
                });
                
                dayDiv.appendChild(dotsContainer);
            }

            dayDiv.addEventListener('click', () => {
                selectedDate = new Date(year, month, i);
                renderCalendar(); // Re-render to move the selection circle
                renderTasks();
            });

            daysGrid.appendChild(dayDiv);
        }
        
        renderTasks();
    }

    function renderTasks() {
        const dateKey = formatDateKey(selectedDate);
        // Update Label
        const weekdays = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
        const months = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
        const weekday = weekdays[selectedDate.getDay()];
        const month = months[selectedDate.getMonth()];
        const day = selectedDate.getDate();
        selectedDateLabel.innerText = `${month}${day}æ—¥ ${weekday}`;

        taskList.innerHTML = "";
        
        const dayEvents = events[dateKey] || [];
        
        if (dayEvents.length === 0) {
            taskList.innerHTML = `<p style="color:var(--ios-gray); text-align:center; margin-top:20px;">æš‚æ— äº‹ä»¶</p>`;
            return;
        }
        
        // Sort by time
        dayEvents.sort((a, b) => a.time.localeCompare(b.time));

        dayEvents.forEach(event => {
            const card = document.createElement('div');
            card.className = 'task-card';
            const category = event.category || 'other';
            const categoryInfo = categoryConfig[category];
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç§äººäº‹é¡¹ä¸”ä¸æ˜¯å½“å‰ç”¨æˆ·åˆ›å»ºçš„
            const isPrivateEvent = event.isPrivate && event.creator !== currentUser.name;
            const displayTitle = isPrivateEvent ? 'ğŸ”’ ç§äººäº‹é¡¹' : event.title;
            const creatorInfo = event.creator && event.creator !== currentUser.name ? 
                `<div style="font-size: 11px; color: var(--ios-gray); margin-top: 2px;">by ${event.creator}</div>` : '';
            
            card.innerHTML = `
                <div class="task-time">${event.time}</div>
                <div class="task-divider ${category}"></div>
                <div class="task-info">
                    <h4>${displayTitle}</h4>
                    ${creatorInfo}
                </div>
                <div class="task-category ${category}">${categoryInfo.emoji} ${categoryInfo.name}</div>
            `;
            taskList.appendChild(card);
        });
    }

    function changeMonth(step) {
        currentDate.setMonth(currentDate.getMonth() + step);
        renderCalendar();
    }
    
    // Helper: Format Date to YYYY-MM-DD for storage keys
    function formatDateKey(date) {
        return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
    }

    // Modal Logic
    function openModal() { modal.style.display = 'flex'; }
    function closeModal() { modal.style.display = 'none'; }
    
    function saveEvent() {
        const title = document.getElementById('eventTitle').value;
        const time = document.getElementById('eventTime').value;
        const category = document.getElementById('eventCategory').value;
        const isPrivate = document.getElementById('isPrivate').checked;
        
        if (title && time && currentUser) {
            const dateKey = formatDateKey(selectedDate);
            if (!events[dateKey]) events[dateKey] = [];
            
            const newEvent = {
                title,
                time,
                category,
                isPrivate,
                creator: currentUser.name,
                id: Date.now() + Math.random() // ç®€å•çš„IDç”Ÿæˆ
            };
            
            events[dateKey].push(newEvent);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveToLocalStorage();
            
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventCategory').value = 'work';
            document.getElementById('isPrivate').checked = false;
            
            closeModal();
            renderCalendar(); // Update dots
            renderTasks(); // Update list
        }
    }

    // ç™»å½•ç›¸å…³å‡½æ•°
    function login() {
        const username = document.getElementById('usernameInput').value.trim();
        if (username) {
            currentUser = {
                name: username,
                avatar: username.charAt(0).toUpperCase(),
                isGuest: false
            };
            
            // å°†ç”¨æˆ·æ·»åŠ åˆ°ç”¨æˆ·åˆ—è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!allUsers.find(user => user.name === username)) {
                allUsers.push({
                    name: username,
                    avatar: username.charAt(0).toUpperCase()
                });
                saveUsersToStorage();
            }
            
            showMainApp();
        }
    }
    
    function showGuestLogin() {
        document.getElementById('guestOptions').style.display = 'block';
    }
    
    function loginAsGuest() {
        const guestName = document.getElementById('guestNameInput').value.trim() || 'è®¿å®¢';
        currentUser = {
            name: guestName,
            avatar: guestName.charAt(0).toUpperCase(),
            isGuest: true
        };
        showMainApp();
    }
    
    function logout() {
        currentUser = null;
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    }
    
    function showMainApp() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'flex';
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
        document.getElementById('userAvatar').textContent = currentUser.avatar;
        document.getElementById('currentUser').textContent = currentUser.name;
        
        // åŠ è½½æ•°æ®
        loadFromLocalStorage();
        renderSharedUsers();
        renderCalendar();
    }
    
    function renderSharedUsers() {
        const container = document.getElementById('sharedUsers');
        container.innerHTML = '';
        
        // æ˜¾ç¤ºå…¶ä»–å·²æ³¨å†Œç”¨æˆ·
        const otherUsers = allUsers.filter(user => user.name !== currentUser.name);
        
        if (otherUsers.length === 0) {
            container.innerHTML = '<div style="font-size: 12px; color: var(--ios-gray); text-align: center; padding: 10px;">æš‚æ— å…¶ä»–ç”¨æˆ·</div>';
            return;
        }
        
        otherUsers.forEach(user => {
            const userDiv = document.createElement('div');
            userDiv.className = 'shared-user';
            userDiv.innerHTML = `
                <div class="user-avatar">${user.avatar}</div>
                <span>${user.name}</span>
                <span style="font-size: 10px; color: var(--ios-gray);">å·²æ³¨å†Œ</span>
            `;
            container.appendChild(userDiv);
        });
    }
    
    // æ•°æ®æŒä¹…åŒ–
    function saveToLocalStorage() {
        const data = {
            events: events,
            users: users,
            lastUpdate: Date.now()
        };
        localStorage.setItem('sharedCalendar', JSON.stringify(data));
    }
    
    function saveUsersToStorage() {
        localStorage.setItem('calendarUsers', JSON.stringify(allUsers));
    }
    
    function loadFromLocalStorage() {
        const saved = localStorage.getItem('sharedCalendar');
        if (saved) {
            const data = JSON.parse(saved);
            events = data.events || {};
            users = data.users || {};
        }
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        const savedUsers = localStorage.getItem('calendarUsers');
        if (savedUsers) {
            allUsers = JSON.parse(savedUsers);
        }
    }
    
    // ç§»é™¤ç¤ºä¾‹æ•°æ®å‡½æ•°ï¼Œè®©æ—¥å†ä»ç©ºç™½å¼€å§‹
    
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    function checkLoginStatus() {
        if (!currentUser) {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        } else {
            showMainApp();
        }
    }
    
    // Initialize
    checkLoginStatus();

</script>

</body>
</html>